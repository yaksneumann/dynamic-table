<div class="table-container" dir="rtl">
  @if (config().badges && config().badges!.length > 0) {
    @if (!isMobile()) {
      <div class="status-badges">
        @for (badge of config().badges; track badge.label) {
          <div class="badge" [ngStyle]="badge.styles">
            <span class="badge-label">{{ badge.label }}</span>
            <span class="badge-count">{{ getBadgeCount(badge) }}</span>
          </div>
        }
      </div>
    } @else {
      <div class="status-badges-mobile">
        @for (badge of config().badges; track badge.label) {
          <div class="badge-mobile" [ngStyle]="badge.styles">
            <span class="badge-label">{{ badge.label }}</span>
            <span class="badge-count">{{ getBadgeCount(badge) }}</span>
          </div>
        }
      </div>
    }
  }

  @if (config().features.enableSearch) {
  <div class="table-controls">
    <input type="text" class="search-input" placeholder="×—×™×¤×•×©..." [value]="searchTerm()"
      (input)="onSearchChange($event)" />
  </div>
  }

  @if (!isMobile()) {
  <div class="table-wrapper">
    <table class="data-table">
      <thead>
        <tr>
          @for (column of visibleColumns(); track column.key) {
          <th [style.width]="column.width" [style.text-align]="column.align">
            {{ column.header }}
            @if (column.sortable) {
            <span class="sort-icon">â†•</span>
            }
          </th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of paginatedData(); track row.id) {
        <tr>
          @for (column of visibleColumns(); track column.key) {
          <td [style.text-align]="column.align">
            @if (column.type === 'action') {
            <div style="display: flex; gap: 8px; justify-content: center;">
              @if (config().features.enableEdit) {
              <button class="edit-btn" (click)="handleEdit(row)" title="×¢×¨×•×š">
                âœ
              </button>
              }
              @if (config().features.enableDelete) {
              <button class="delete-btn" (click)="handleDelete(row)" title="××—×§">
                ğŸ—‘ï¸
              </button>
              }
            </div>
            } @else if (column.type === 'badge') {
            <span class="status-badge" [style]="getCellStyle(column, row[column.key], row)"
              [style.background-color]="getStatusColor(row[column.key])">
              {{ getCellValue(column, row) }}
            </span>
            } @else {
            <span [style]="getCellStyle(column, row[column.key], row)">
              {{ getCellValue(column, row) }}
            </span>
            }
          </td>
          }
        </tr>
        } @empty {
        <tr>
          <td [attr.colspan]="visibleColumns().length" class="empty-state">
            ××™×Ÿ × ×ª×•× ×™× ×œ×”×¦×’×”
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }

  @if (isMobile()) {
  <div class="cards-container">
    @for (row of paginatedData(); track row.id) {
    <div class="mobile-card" (click)="openDetail(row, 'view')">
      <div class="card-header">
        <span class="card-id">{{ row.id }}</span>
        @if (row.status !== undefined) {
        <span class="status-badge" [style.background-color]="getStatusColor(row.status)">
          {{ getFormattedStatus(row) }}
        </span>
        }
      </div>
      <div class="card-body">
        @for (column of visibleColumns(); track column.key) {
        @if (column.type !== 'action' && column.key !== 'id') {
        <div class="card-row">
          <span class="label">{{ column.header }}:</span>
          @if (column.type === 'badge') {
          <span class="value status-badge" [style]="getCellStyle(column, row[column.key], row)"
            [style.background-color]="getStatusColor(row[column.key])">
            {{ getCellValue(column, row) }}
          </span>
          } @else {
          <span class="value" [style]="getCellStyle(column, row[column.key], row)">
            {{ getCellValue(column, row) }}
          </span>
          }
        </div>
        }
        }
      </div>
      <div class="card-footer">
        @if (config().features.enableEdit) {
        <button class="card-action-btn" (click)="handleEdit(row); $event.stopPropagation()" title="×¢×¨×•×š"
          style="background-color: transparent; border: 1px solid #ccc; border-radius: 4px;">
          âœï¸
        </button>
        }
        @if (config().features.enableDelete) {
        <button class="card-action-btn" (click)="handleDelete(row); $event.stopPropagation()" title="××—×§"
          style="background-color: transparent; border: 1px solid #f44336; border-radius: 4px; color: #f44336;">
          ğŸ—‘ï¸
        </button>
        }
      </div>
    </div>
    } @empty {
    <div class="empty-state">××™×Ÿ × ×ª×•× ×™× ×œ×”×¦×’×”</div>
    }
  </div>
  }

  <div class="pagination">
    <div class="pagination-info">
      ××¦×™×’ {{ currentPageRange.start }} - {{ currentPageRange.end }} ××ª×•×š {{ filteredData().length }}
    </div>

    <div class="pagination-controls">
      <button class="page-btn" (click)="goToPage(1)" [disabled]="pagination().currentPage === 1">
        ×¨××©×•×Ÿ
      </button>
      <button class="page-btn" (click)="goToPage(pagination().currentPage - 1)"
        [disabled]="pagination().currentPage === 1">
        ×”×§×•×“×
      </button>

      @for (page of [].constructor(totalPages); track $index) {
      @if (shouldShowPageButton($index + 1)) {
      <button class="page-btn"
        [class.active]="$index + 1 === pagination().currentPage" (click)="goToPage($index + 1)">
        {{ $index + 1 }}
      </button>
      }
      }

        <button class="page-btn" (click)="goToPage(pagination().currentPage + 1)"
          [disabled]="pagination().currentPage === totalPages">
          ×”×‘×
        </button>
        <button class="page-btn" (click)="goToPage(totalPages)"
          [disabled]="pagination().currentPage === totalPages">
          ××—×¨×•×Ÿ
        </button>
    </div>

    <div class="page-size-selector">
      <label>×©×•×¨×•×ª ×‘×¢××•×“:</label>
      <select [value]="pagination().pageSize" (change)="changePageSize(+$any($event.target).value)">
        @for (size of pagination().pageSizeOptions; track size) {
        <option [value]="size" [selected]="size === pagination().pageSize">{{ size }}</option>
        }
      </select>
    </div>
  </div>

  @if (detailModal().isOpen && detailModal().data) {
  <div class="modal-overlay" (click)="closeDetail()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ detailModal().data!.id }}</h2>
        <button class="close-btn" (click)="closeDetail()">âœ•</button>
      </div>

      <div class="modal-body">
        <div class="detail-grid">
          @for (column of config().columns; track column.key) {
          @if (column.type !== 'action') {
          <div class="detail-field">
            <label>{{ column.header }}:</label>
            @if (detailModal().mode === 'edit' && column.key !== 'id') {
            <input [(ngModel)]="detailModal().data![column.key]" />
            } @else {
            @if (column.type === 'badge') {
            <span class="status-badge" [style.background-color]="getStatusColor(detailModal().data![column.key])">
              {{ getCellValue(column, detailModal().data!) }}
            </span>
            } @else {
            <span>
              {{ getCellValue(column, detailModal().data!) }}
            </span>
            }
            }
          </div>
          }
          }
        </div>
      </div>

      <div class="modal-footer">
        @if (detailModal().mode === 'edit') {
        <button class="btn btn-primary" (click)="saveDetail()">×©××•×¨</button>
        <button class="btn btn-secondary" (click)="closeDetail()">×‘×™×˜×•×œ</button>
        } @else {
        <button class="btn btn-primary" (click)="detailModal().mode = 'edit'">
          ×¢×‘×•×¨ ×œ××¦×‘ ×¢×¨×™×›×”
        </button>
        <button class="btn btn-secondary" (click)="closeDetail()">×¡×’×•×¨</button>
        }
      </div>
    </div>
  </div>
  }
</div>